### Notes on Express API Setup Transcript

#### **Key Components:**
1. **Express Server Setup:**
   - Acts as the API layer to communicate with Redis, Postgres, and React.
   - Uses `express`, `body-parser`, `cors`, and `nodemon` for development.
   - Routes handle requests from React, interact with Redis/Postgres, and return responses.

2. **Dependencies:**
   - `express@4.16.3`
   - `pg@7.4.3` (Postgres client)
   - `redis@2.8.0` (Redis client)
   - `cors@2.8.4`
   - `nodemon@1.18.3` (for auto-restart during development)
   - `body-parser` (added later to parse incoming JSON requests).

3. **Configuration:**
   - `keys.js` stores environment variables for Redis and Postgres connections:
     ```javascript
     module.exports = {
       redisHost: process.env.REDIS_HOST,
       redisPort: process.env.REDIS_PORT,
       pgUser: process.env.PG_USER,
       pgHost: process.env.PG_HOST,
       pgDatabase: process.env.PG_DATABASE,
       pgPassword: process.env.PG_PASSWORD,
       pgPort: process.env.PG_PORT
     };
     ```

4. **Postgres Setup:**
   - Creates a table `values` to store submitted indices.
   - Uses `pg.Pool` to manage connections.
   - Initial query ensures the table exists:
     ```javascript
     pgClient.query('CREATE TABLE IF NOT EXISTS values (number INT)').catch(err => console.log(err));
     ```

5. **Redis Setup:**
   - Connects to Redis using `redis.createClient`.
   - Uses a duplicate client (`redisPublisher`) for publishing events.
   - Retry strategy reconnects every 1 second if the connection is lost.

6. **Route Handlers:**
   - **Root (`/`)**: Test route returning "hi".
   - **`/values/all`**: Fetches all indices stored in Postgres.
   - **`/values/current`**: Retrieves calculated values from Redis.
   - **POST `/values`**: Accepts new indices, validates them (index < 40), stores in Redis and Postgres, and publishes an event for the worker to process.

7. **Server Initialization:**
   - Listens on port 5000:
     ```javascript
     app.listen(5000, () => console.log('Listening'));
     ```

#### **Workflow:**
1. React submits an index to Express.
2. Express stores the index in Postgres and Redis (with "Nothing yet!" as a placeholder).
3. Express publishes an event to Redis.
4. Worker processes the event, calculates the Fibonacci value, and updates Redis.
5. React fetches results from Express, which retrieves data from Redis/Postgres.

#### **Debugging Tip:**
- If `node index.js` fails with module errors, check for typos in `index.js` or `keys.js`. The correct code is available in later sections of the tutorial.