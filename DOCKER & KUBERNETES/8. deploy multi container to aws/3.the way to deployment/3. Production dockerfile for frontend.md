### Explanation of Multiple Nginx Instances and Configuration Changes

The text describes the setup for a **multi-container deployment** where two Nginx instances are used:  
1. **Routing Nginx**: Handles incoming traffic and routes requests to appropriate services.  
2. **Client Nginx**: Serves production React assets on port `3000` (instead of default port `80`).  

---

### Key Changes for Production Deployment:

#### 1. **Client Nginx Configuration (`default.conf`)**  
   - **Purpose**: Override the default Nginx port (`80` → `3000`) and specify where React assets are served.  
   - **File Location**: `client/nginx/default.conf`  
   - **Example**:  
     ```nginx
     server {
       listen 3000;  # Changed from port 80
       location / {
         root /usr/share/nginx/html;
         index index.html index.htm;
       }
     }
     ```

#### 2. **Production Dockerfile for React (Client)**  
   - **Multi-Stage Build**:  
     1. **Builder Phase**: Uses `node:alpine` to install dependencies and build React assets.  
     2. **Nginx Phase**: Copies the built assets and custom `default.conf` to serve them on port `3000`.  
   - **File Location**: `client/Dockerfile`  
   - **Example**:  
     ```dockerfile
     # Builder phase
     FROM node:alpine AS builder
     WORKDIR /app
     COPY package.json .
     RUN npm install
     COPY . .
     RUN npm run build  # Creates /app/build

     # Nginx phase
     FROM nginx
     EXPOSE 3000
     COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf
     COPY --from=builder /app/build /usr/share/nginx/html
     ```

#### 3. **Why Two Nginx Instances?**  
   - **Separation of Concerns**:  
     - **Routing Nginx**: Directs traffic (e.g., `/api` → Express, `/` → React).  
     - **Client Nginx**: Focuses solely on serving static React files.  
   - **Flexibility**: Allows swapping the client server (e.g., to a CDN) without disrupting routing logic.  

#### 4. **Test Cleanup (`App.test.js`)**  
   - **Issue**: Tests fail because `fib` component tries to call a non-running Express API.  
   - **Fix**: Remove or mock API calls in tests.  
   - **Example**:  
     ```javascript
     // Before (failing test)
     test('renders without crashing', () => {
       render(<App />);  // Crashes due to API call
     });

     // After (simplified test)
     test('renders without crashing', () => {
       render(<div />);  // Placeholder test
     });
     ```

---

### Diagram: Multi-Container Architecture  
```
Browser
  │
  ▼
Routing Nginx (Port 80)  ←─┐
  │                         │
  ├─ /api → Express Server  │
  │                         │
  └─ /   → Client Nginx (Port 3000)  
                              Serves React assets from /usr/share/nginx/html
```

---

### Key Takeaways:  
1. **Port Customization**: Client Nginx listens on `3000` to avoid conflicts with the routing Nginx.  
2. **Multi-Stage Builds**: Optimize Docker images by separating build and runtime steps.  
3. **Testing**: Ensure tests don’t depend on external services (mock API calls).  

This setup ensures scalable, production-ready deployments with clear separation between routing and asset serving. 🚀