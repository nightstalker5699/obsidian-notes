# Creating Tables for ZTM Database - Comprehensive Guide

## Database Schema Overview

The ZTM database consists of 5 main tables with relationships:
- **Students** (1-to-many with Enrollments)
- **Teachers** (1-to-many with Courses)
- **Subjects** (1-to-many with Courses)
- **Courses** (many-to-many with Students through Enrollments)
- **Enrollments** (junction table)

## Table Creation Process

### 1. Enabling UUID Extension
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

### 2. Creating Custom Types and Domains
```sql
-- Create rating domain (1-5)
CREATE DOMAIN rating AS SMALLINT
CHECK (VALUE > 0 AND VALUE <= 5);

-- Create feedback composite type
CREATE TYPE feedback_type AS (
  student_id UUID,
  rating rating,
  feedback_text TEXT
);
```

### 3. Creating Independent Tables First

#### Students Table
```sql
CREATE TABLE student (
  student_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email TEXT NOT NULL,
  date_of_birth DATE NOT NULL
);
```

#### Subjects Table
```sql
CREATE TABLE subject (
  subject_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  subject_name TEXT NOT NULL,
  description TEXT
);
```

#### Teachers Table
```sql
CREATE TABLE teacher (
  teacher_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  first_name VARCHAR(255) NOT NULL,
  last_name VARCHAR(255) NOT NULL,
  email TEXT NOT NULL,
  date_of_birth DATE NOT NULL
);
```

### 4. Creating Dependent Tables

#### Courses Table
```sql
CREATE TABLE course (
  course_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  course_name TEXT NOT NULL,
  description TEXT,
  subject_id UUID NOT NULL REFERENCES subject(subject_id),
  teacher_id UUID NOT NULL REFERENCES teacher(teacher_id),
  feedback feedback_type[]  -- Array of feedback_type
);
```

#### Enrollments Table (Junction Table)
```sql
CREATE TABLE enrollment (
  course_id UUID NOT NULL REFERENCES course(course_id),
  student_id UUID NOT NULL REFERENCES student(student_id),
  enrollment_date DATE NOT NULL,
  CONSTRAINT pk_enrollment PRIMARY KEY (course_id, student_id)
);
```

## Handling Common Issues

### Adding Missing Columns
```sql
-- Example: Adding email to student table after creation
ALTER TABLE student ADD COLUMN email TEXT NOT NULL;
```

### Correcting Case Sensitivity
```sql
-- When custom types appear lowercase
CREATE TABLE example (
  feedback "Feedback_Type"[]  -- Double quotes preserve case
);
```

## Best Practices

1. **Create independent tables first** before those with foreign key dependencies
2. **Use UUIDs** for primary keys with `uuid_generate_v4()` as default
3. **Name constraints** for better error messages and documentation
4. **Add NOT NULL** constraints where appropriate
5. **Use composite primary keys** for junction tables (like enrollments)
6. **Consider array types** for one-to-many relationships within the same table

## Data Model Considerations

1. The feedback array in the course table is denormalized - consider a separate feedback table for production
2. Email validation could be added with CHECK constraints
3. Enrollment table could be enhanced with status fields (active, completed, etc.)
4. Consider adding timestamps (created_at, updated_at) to all tables

## Next Steps

After creating tables, you'll want to:
1. Insert test data
2. Create indexes on frequently queried columns
3. Set up views for common queries
4. Consider adding triggers for audit logging
5. Implement functions for complex operations

This schema provides a solid foundation for a course management system while demonstrating PostgreSQL's advanced features like UUIDs, custom types, and array columns.