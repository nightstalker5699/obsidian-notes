# SQL Views: A Comprehensive Guide with Examples

## What Are SQL Views?

Views are virtual tables that represent the results of a stored query. They allow you to:
- Save complex queries for reuse
- Simplify frequent data access patterns
- Provide a security layer by restricting column access
- Abstract underlying table structures

## Types of Views

### 1. Non-Materialized Views (Standard Views)
- **Definition**: Stores only the query definition, not the data
- **Behavior**: Executes the underlying query each time the view is accessed
- **Storage**: Takes very little space (just the query text)
- **Example**:
  ```sql
  CREATE VIEW active_customers AS
  SELECT customer_id, name, email 
  FROM customers
  WHERE status = 'active';
  ```

### 2. Materialized Views
- **Definition**: Stores both the query definition and the actual data
- **Behavior**: Data is physically stored and periodically refreshed
- **Use Case**: Improves performance for complex queries on large datasets
- **Example** (PostgreSQL syntax):
  ```sql
  CREATE MATERIALIZED VIEW monthly_sales_summary AS
  SELECT 
      DATE_TRUNC('month', order_date) AS month,
      SUM(net_amount) AS total_sales
  FROM orders
  GROUP BY DATE_TRUNC('month', order_date)
  WITH DATA;
  ```

## View Management Syntax

### Creating Views
```sql
CREATE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
WHERE condition;
```

**Example**:
```sql
CREATE VIEW high_value_orders AS
SELECT order_id, customer_id, net_amount
FROM orders
WHERE net_amount > 1000;
```

### Modifying Views
```sql
CREATE OR REPLACE VIEW view_name AS
SELECT new_column_list
FROM tables
WHERE new_conditions;
```

**Example**:
```sql
CREATE OR REPLACE VIEW high_value_orders AS
SELECT order_id, customer_id, net_amount, order_date
FROM orders
WHERE net_amount > 500;
```

### Renaming Views
```sql
ALTER VIEW old_name RENAME TO new_name;
```

**Example**:
```sql
ALTER VIEW high_value_orders RENAME TO premium_orders;
```

### Dropping Views
```sql
DROP VIEW [IF EXISTS] view_name;
```

**Example**:
```sql
DROP VIEW IF EXISTS premium_orders;
```

## Practical View Examples

### Example 1: Simplifying Complex Joins
```sql
CREATE VIEW customer_order_details AS
SELECT 
    c.customer_id,
    c.name,
    c.email,
    o.order_id,
    o.order_date,
    o.net_amount,
    p.product_name,
    p.category
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id;
```

### Example 2: Security View (Column Restriction)
```sql
CREATE VIEW public_employee_info AS
SELECT 
    employee_id,
    first_name,
    last_name,
    department,
    job_title
FROM employees;
-- Excludes sensitive columns like salary, SSN, etc.
```

### Example 3: Aggregated Reporting View
```sql
CREATE VIEW monthly_sales_by_region AS
SELECT 
    r.region_name,
    DATE_TRUNC('month', o.order_date) AS month,
    SUM(o.net_amount) AS total_sales,
    COUNT(o.order_id) AS order_count
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN regions r ON c.region_id = r.region_id
GROUP BY r.region_name, DATE_TRUNC('month', o.order_date);
```

## Key Differences: Non-Materialized vs. Materialized Views

| Feature              | Non-Materialized View             | Materialized View                 |
|----------------------|-----------------------------------|-----------------------------------|
| Data Storage         | Stores only query definition      | Stores actual data                |
| Performance          | Slower (runs query each time)     | Faster (reads stored data)        |
| Storage Space        | Very little                       | More (stores actual results)      |
| Data Freshness       | Always current                    | Requires refresh to stay current  |
| Update Mechanism     | Automatic on each access          | Manual or scheduled refresh       |
| Use Case             | Most common, general purpose      | Complex queries on large data     |

## Best Practices for Using Views

1. **Naming Conventions**: Use consistent, descriptive names (e.g., `customer_order_summary_v`)
2. **Document Views**: Add comments explaining the view's purpose
3. **Limit Complexity**: Avoid extremely complex views that reference other views
4. **Security**: Use views to implement column-level security
5. **Performance**: Consider materialized views for frequently accessed complex queries
6. **Refresh Strategy**: For materialized views, establish a refresh schedule

Views are powerful tools that can significantly improve your SQL workflow by making queries more reusable, maintainable, and secure.